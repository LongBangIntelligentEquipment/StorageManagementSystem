<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta  content="yes"  name="apple-mobile-web-app-capable">
    <meta  name="viewport"  content="maximum-scale=1.0,user-scalable=no">
    <title>隆邦ERP系统_BOM表管理</title>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" language="javascript">


        function confirmAgain() {
            var elementLength=document.getElementById('shellBox').children.length;

            for(var i=0;i<elementLength;i++){
                var elementLengthInt=parseInt(elementLength)-i-1
                var oldElementId='#belongMachine'+elementLengthInt
                $(oldElementId).removeAttr("disabled","disabled")
            }
            return window.confirm("确认执行【添加新型物料】操作?");
        }
        function Authority(role ,ojId) {
            if(document.getElementById('role').innerText===role){
                document.getElementById(ojId).style.display='';
            }
            if(document.getElementById('role').innerText==='系统管理员'){
                // document.getElementById('authority').style.display='';
            }else{
                document.getElementById('authority').style.display='none';
            }
        }

        function addSelectBox() {
            var elementLength=document.getElementById('shellBox').children.length;
            var loadMachineLength=<%=machine.length%>-document.getElementById('shellBox').children.length;
            var belongMachineList=[];
            var saveMachineNum=[];

            if(loadMachineLength>0){
                var elementLengthInt=parseInt(elementLength)-1
                var oldElementId='#belongMachine'+elementLengthInt
                $(oldElementId).attr("disabled","disabled")

                for(var i=0;i<document.getElementById('shellBox').children.length;i++){
                    var elementId='#belongMachine'+i
                    belongMachineList.push($(elementId).find("option:selected").text())
                }
                <%for(var i=0;i<machine.length;i++){%>
                 saveMachineNum.push('<%=machine[i].machineName%> <%= machine[i].machineId %>')
                <%}%>

                <%for(var i=0;i<machine.length;i++){%>
                    var judgePra1='<%=machine[i].machineName%> <%= machine[i].machineId %>'
                    for(var j=0;j<belongMachineList.length;j++){
                        var judgePra2=belongMachineList[j]
                        var asd=judgePra1.toString()!==judgePra2.toString().toString()
                        if(judgePra1.toString()===judgePra2.toString()){
                              saveMachineNum.splice(saveMachineNum.indexOf('<%=machine[i].machineName%> <%= machine[i].machineId %>'),1)

                        }
                    }
               <% }%>


                var element='belongMachine'+elementLength;
                let html =                 '<div id="belongMachineBox'+elementLength+'" style="margin-bottom: 5px">\n' +
                    '                                <select class="itemDetailsInput addItemInfo" name="'+element+'"'+ 'id="'+element+'"'+ 'required="required"  style="height: 35px;width: 450px;color:black;margin-bottom: 3px" >\n';

                for(var i=0;i<saveMachineNum.length;i++){
                    html += '<option value="'+saveMachineNum[i].split(' ')[1]+'">';
                    html += ''+saveMachineNum[i]+'';
                    html += '</option>\n';
                }

                html += '                                </select>\n';
                html += '                                    <button class="searchBarButton" onclick="deleteSelectBox(\'belongMachineBox'+elementLength+'\')" type="button"  style="background-color: red!important;width: 100px;margin-left: 10px;">删除</button>\n';
                html += '                                </div>';

                $('#shellBox').append( html)
            }else {
                alert("没有更多的机型可选择")
            }

            document.getElementById('machineCount').value = document.getElementById('shellBox').children.length;
            console.log(document.getElementById('machineCount').value)

        }

        function deleteSelectBox(deleteElementId) {
            document.getElementById(deleteElementId).remove()

            document.getElementById('machineCount').value = document.getElementById('shellBox').children.length;
            console.log(document.getElementById('machineCount').value)

        }

    </script>

</head>
<body >


<section class="functionBoard" >

    <div class="functionBoard left">
        <div>
            <h1 class="functionBoard-Title "><img src='images/LBLogo.png' height="99px" width="220px"></h1>
            <u1>
                <li class="list-group"><button class="functionBoard-Button" type="button" onclick="location.href='/adminHome'">首页</button></li>
                <li class="list-group"><button class="functionBoard-Button" type="button"  onclick="location.href='/adItemMan'">物料管理</button></li>
                <li class="list-group"><button class="functionBoard-Button" type="button"  onclick="location.href='/adOrderMan'">采购管理</button></li>
                <li class="list-group"><button class="functionBoard-Button current" type="button"  onclick="location.href='/adBOMListMan'">BOM表管理</button></li>
                <li class="list-group"><button class="functionBoard-Button" type="button" onclick="location.href='/adUserMan'" style="">权限管理</button></li>
            </u1>
            <button class="functionBoard-Button" type="button" id="buttonRegist" onclick="location.href='/logout'" style="position: fixed;bottom: 6%;" >退出登录</button>
        </div>





    </div>
    </div>


    <div class="functionBoard right">
        <main role="main" class="container mt-3 mb-3">

            <header role="banner">
                <div class="headcontainer">
                    <div class="page-title">
                        BOM表管理
                    </div>
                    <span class="page-title" style="position: absolute;padding-top: 45px;margin-left: 5px;flex:0 1 auto;font-weight: normal; font-size: 0.8rem">欢迎您，</span><span id="role" class="page-title" style="position: absolute;margin-left: 55px; padding-top: 45px;flex:0 1 auto;font-weight: normal; font-size: 0.8rem"><%=user.role%></span><span class="page-title" style="padding-top: 45px;position: absolute;margin-left: 120px;flex:0 1 auto;font-weight: normal; font-size: 0.8rem">&emsp;<%=user.userName%></span>
                </div>
            </header>

            <form onsubmit="return confirmAgain()" method="post" enctype="multipart/form-data" >

                            <div  class="itemDetailsPage" style="width: 100%">
                                <div class="itemDetail">创建新部件：</div>
                                <div class="itemDetail">名称<a style="color: red; font-size: x-large">*</a>：<input type="text" name="addComponentName" class="itemDetailsInput addItemInfo" id="detail1" required="required"  style="width: 500px" placeholder="请输入部件名称" ></div>
                                <div class="itemDetail">图号<a style="color: red; font-size: x-large">*</a>：<input name="addComponentModel" class="itemDetailsInput addItemInfo" id="detail2"    style="width: 500px" placeholder="请输入部件图号" ></div>
                                <div class="itemDetail" >类型<a style="color: red; font-size: x-large">*</a>：<select class="itemDetailsInput addItemInfo" name="addComponentType" id="detail3" required="required"  style="height: 35px;width: 130px;color:black;" >
                                        <%for(let i = 0; i < categoryName.length; i++) { %>
                                        <option value="<%=categoryName[i].categoryName%>"><%=categoryName[i].categoryName%></option>
                                        <%}%>
                                    </select>
                                    <span>
                                        <button class="searchBarButton" onclick="location.href='/adBOMListCategoryMan'" type="button" id="manageCategoryButton" style="background-color: #0050fa!important;width: 100px;margin-left:30px">管理分类</button>
                                    </span>
                                </div>
                                <div class="itemDetail">所属机型<a style="color: red; font-size: x-large">*</a>：
                                    <span>
                                        <button class="searchBarButton" onclick="addSelectBox()" type="button" id="manageCategoryButton" style="background-color: #0050fa!important;width: 150px;margin-left:-10px;margin-bottom: 3px;background-color: #00cb46!important;">添加所属机型</button>
                                    </span>
                                </div>
                                <div id="shellBox" >
                                    <div style="margin-bottom: 5px">
                                        <select class="itemDetailsInput addItemInfo" name="belongMachine0"
                                                id="belongMachine0" required="required"
                                                style="height: 35px;width: 450px;color:black;margin-bottom: 3px" >
                                            <% for (let i = 0; i < machine.length; i++){ %>
                                            html += '
                                            <option value="<%= machine[i].machineId %>"><%= machine[i].machineName %> <%= machine[i].machineId %></option>
                                            \n'
                                            <% } %>
                                        </select>
                                    </div>
                                </div>

                                <input name="machineCount" id="machineCount" type="hidden">

                                <div id="shellBox2">
                                    <div class="itemDetail" >备注：<input name="addComponentNote" class="itemDetailsInput addItemInfo" id="detail6" style="width: 500px" ></div>
                                    <div class="itemDetail" id="detail7" >上传图纸：<input name="addComponentNameFileName" class="itemDetailsInput addItemInfo" type="file" style="width: 462px"></div>
                                </div>
                            </div>






                            <button class="btn btn-block btn-submit button button--primary smaller" type="submit"   id="confirmButton"  style=" height: 50px;width: 555px;background-color: #00cb46!important;margin-top: 15px; margin-left: 30px">创建新部件</button>
                <style onload="Authority('系统管理员','confirmButton')"></style>
                <style onload="Authority('仓库管理员','confirmButton')"></style>

            </form>


        </main>
    </div>
</section>





<footer class="footer" role="contentinfo">
    <div class="container">
        <span id="copyright">Copyright © 佛山琉智科技有限公司</span>
    </div>
</footer>


</body>

</html>